<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>私有云</title>
      <link href="/posts/df2b.html"/>
      <url>/posts/df2b.html</url>
      
        <content type="html"><![CDATA[<h2 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h2><h3 id="基础运维任务"><a href="#基础运维任务" class="headerlink" title="基础运维任务"></a>基础运维任务</h3><p>设置各服务器节点的IP地址，确保网络正常通信，设置云服务器1主机名为Controller，云服务器2主机名为Compute，并在各服务器节点中设置主机名与IP地址的映射、关闭防火墙并设置为开机不启动、SELinux 为 Permissive 模式。（1分）<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname controller <span class="comment">#计算节点compute</span></span><br><span class="line">bash</span><br><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure></p><p>hosts内容<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.10 controller</span><br><span class="line">192.168.10.20 compute</span><br><span class="line"></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br></pre></td></tr></table></figure></p><p>2．将提供的CentOS-7-x86_64-DVD-1804.iso和OpenStackQueens.iso光盘镜像上传到Controller服务器的/root目录下，然后在/opt目录下分别创建centos目录和openstack目录，并将镜像文件CentOS-7-x86_64-DVD-1804.iso挂载到centos目录下，将镜像文件OpenStackQueens.iso挂载到openstack目录下。（1分）<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/centos</span><br><span class="line">mkdir /opt/iaas</span><br><span class="line">mount -o loop chinaskills_cloud_iaas.iso /opt/iaas/</span><br><span class="line">mount -o loop CentOS-7.5-x86_64-DVD-1804.iso /opt/centos/</span><br></pre></td></tr></table></figure></p><p>3．在Controller服务器上利用centos目录中的软件包安装vsftp服务器并设置开机自启动，提供yum仓库服务，并分别设置controller和compute服务器的yum源文件ftp.repo，其中节点的地址使用主机名形式。（1分）<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /etc/yum.repos.d/*</span><br><span class="line">vi /etc/yum.repos.d/http.repo</span><br><span class="line">yum repolist</span><br><span class="line">yum install -y vsftpd</span><br><span class="line">vi /etc/vsftpd/vsftpd.conf  #vsftpd.conf内容加入anon_root=/opt</span><br><span class="line">systemctl restart vsftpd</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><br>controller节点repo<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=file:///opt/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><br>compute节点<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://controller/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://controller/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure></p><p>4．在Controller服务器上部署chrony服务器，允许其他节点同步时间，启动服务并设置为开机启动；并在compute服务器上指定controller服务器为上游NTP服务器，重启服务并设为开机启动。（1分）<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install chrony</span><br><span class="line">vi /etc/chrony.conf</span><br><span class="line">systemctl enable chronyd</span><br><span class="line">systemctl status chronyd</span><br><span class="line">systemctl restart chronyd</span><br><span class="line">chronyc sources //查询时间同步 出现*才算完成</span><br></pre></td></tr></table></figure><br>chrony.conf内容<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">#server 0.centos.pool.ntp.org iburst </span><br><span class="line">#server 1.centos.pool.ntp.org iburst</span><br><span class="line">#server 2.centos.pool.ntp.org iburst</span><br><span class="line">server controller iburst  #compute改以上四条</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Record the rate at which the system clock gains/losses time.</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"></span><br><span class="line"># Allow the system clock to be stepped in the first three updates</span><br><span class="line"># if its offset is larger than 1 second.</span><br><span class="line">makestep 1.0 3</span><br><span class="line"></span><br><span class="line"># Enable kernel synchronization of the real-time clock (RTC).</span><br><span class="line">rtcsync</span><br><span class="line"></span><br><span class="line"># Enable hardware timestamping on all interfaces that support it.</span><br><span class="line">#hwtimestamp *</span><br><span class="line"></span><br><span class="line"># Increase the minimum number of selectable sources required to adjust</span><br><span class="line"># the system clock.</span><br><span class="line">#minsources 2</span><br><span class="line"></span><br><span class="line"># Allow NTP client access from local network.</span><br><span class="line">allow 192.168.10.0/24 </span><br><span class="line"></span><br><span class="line"># Serve time even if not synchronized to a time source.</span><br><span class="line">local stratum 10</span><br><span class="line"></span><br><span class="line"># Specify file containing keys for NTP authentication.</span><br><span class="line">#keyfile /etc/chrony.keys</span><br><span class="line"></span><br><span class="line"># Specify directory for log files.</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line"># Select which information is logged.</span><br><span class="line">#log measurements statistics tracking</span><br></pre></td></tr></table></figure><br>5．在compute节点上创建2个20G的磁盘分区。（1分）<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   200G  0 disk</span><br><span class="line">├─sda1            8:1    0     1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   199G  0 part</span><br><span class="line">  ├─centos-root 253:0    0    50G  0 lvm  /</span><br><span class="line">  ├─centos-swap 253:1    0   7.9G  0 lvm  [SWAP]</span><br><span class="line">  └─centos-home 253:2    0 141.1G  0 lvm  /home</span><br><span class="line">sdb               8:16   0    50G  0 disk</span><br><span class="line">sr0              11:0    1   4.2G  0 rom</span><br><span class="line">[root@compute ~]# fdisk /dev/sdb</span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">使用磁盘标识符 0x95832372 创建新的 DOS 磁盘标签。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (1-4，默认 1)：</span><br><span class="line">起始 扇区 (2048-104857599，默认为 2048)：</span><br><span class="line">将使用默认值 2048</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-104857599，默认为 104857599)：+20G</span><br><span class="line">分区 1 已设置为 Linux 类型，大小设为 20 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (2-4，默认 2)：</span><br><span class="line">起始 扇区 (41945088-104857599，默认为 41945088)：</span><br><span class="line">将使用默认值 41945088</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (41945088-104857599，默认为 104857599)：+20G</span><br><span class="line">分区 2 已设置为 Linux 类型，大小设为 20 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">正在同步磁盘。</span><br></pre></td></tr></table></figure></p><h2 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h2><h3 id="环境变量配置（1分）"><a href="#环境变量配置（1分）" class="headerlink" title="环境变量配置（1分）"></a>环境变量配置（1分）</h3><p>在控制节点和计算节点分别安装iaas-xiandian软件包，根据表2完成脚本文件openrc.sh的配置<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install iaas-xiandian -y</span><br><span class="line">vi /etc/xiandian/openrc.sh</span><br><span class="line">scp /etc/xiandian/openrc.sh compute:/etc/xiandian/openrc.sh</span><br></pre></td></tr></table></figure><br>openrc.sh内容 （:%s/PASS=/PASS=000000/g）替换<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">#--------------------system Config--------------------##</span><br><span class="line">#Controller Server Manager IP. example:x.x.x.x</span><br><span class="line">HOST_IP=192.168.10.10//controller节点nat网卡的ip</span><br><span class="line"></span><br><span class="line">#Controller HOST Password. example:000000 </span><br><span class="line">HOST_PASS=000000</span><br><span class="line"></span><br><span class="line">#Controller Server hostname. example:controller</span><br><span class="line">HOST_NAME=controller</span><br><span class="line"></span><br><span class="line">#Compute Node Manager IP. example:x.x.x.x</span><br><span class="line">HOST_IP_NODE=192.168.10.20//compute节点nat网卡IP</span><br><span class="line"></span><br><span class="line">#Compute HOST Password. example:000000 </span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line"></span><br><span class="line">#Compute Node hostname. example:compute</span><br><span class="line">HOST_NAME_NODE=compute</span><br><span class="line"></span><br><span class="line">#--------------------Chrony Config-------------------##</span><br><span class="line">#Controller network segment IP.  example:x.x.0.0/16(x.x.x.0/24)</span><br><span class="line">network_segment_IP=192.168.10.0/24  //两个节点nat网卡的网段 用于时间同步服务</span><br><span class="line"></span><br><span class="line">#--------------------Rabbit Config ------------------##</span><br><span class="line">#user for rabbit. example:openstack</span><br><span class="line">RABBIT_USER=openstack</span><br><span class="line"></span><br><span class="line">#Password for rabbit user .example:000000</span><br><span class="line">RABBIT_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------MySQL Config---------------------##</span><br><span class="line">#Password for MySQL root user . exmaple:000000</span><br><span class="line">DB_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Keystone Config------------------##</span><br><span class="line">#Password for Keystore admin user. exmaple:000000</span><br><span class="line">DOMAIN_NAME=demo</span><br><span class="line">ADMIN_PASS=000000</span><br><span class="line">DEMO_PASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Mysql keystore user. exmaple:000000</span><br><span class="line">KEYSTONE_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Glance Config--------------------##</span><br><span class="line">#Password for Mysql glance user. exmaple:000000</span><br><span class="line">GLANCE_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore glance user. exmaple:000000</span><br><span class="line">GLANCE_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Nova Config----------------------##</span><br><span class="line">#Password for Mysql nova user. exmaple:000000</span><br><span class="line">NOVA_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore nova user. exmaple:000000</span><br><span class="line">NOVA_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Neturon Config-------------------##</span><br><span class="line">#Password for Mysql neutron user. exmaple:000000</span><br><span class="line">NEUTRON_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore neutron user. exmaple:000000</span><br><span class="line">NEUTRON_PASS=000000</span><br><span class="line"></span><br><span class="line">#metadata secret for neutron. exmaple:000000</span><br><span class="line">METADATA_SECRET=000000</span><br><span class="line"></span><br><span class="line">#Tunnel Network Interface. example:x.x.x.x</span><br><span class="line">INTERFACE_IP=172.17.1.10     //当前节点的内网IP 也就是controller节点的nat网卡IP   在compute节点就是172.17.1.20</span><br><span class="line">   两个节点的配置文件就这里不一样 其他直接复制即可</span><br><span class="line"></span><br><span class="line">#External Network Interface. example:eth1</span><br><span class="line">INTERFACE_NAME=ens33         //内网网卡=nat网卡</span><br><span class="line"></span><br><span class="line">#External Network The Physical Adapter. example:provider</span><br><span class="line">Physical_NAME=provider   //供应商名称  默认</span><br><span class="line"></span><br><span class="line">#First Vlan ID in VLAN RANGE for VLAN Network. exmaple:101</span><br><span class="line">minvlan=101//VLAN id 默认</span><br><span class="line"></span><br><span class="line">#Last Vlan ID in VLAN RANGE for VLAN Network. example:200</span><br><span class="line">maxvlan=200//VLAN id 默认</span><br><span class="line"></span><br><span class="line">#--------------------Cinder Config--------------------##</span><br><span class="line">#Password for Mysql cinder user. exmaple:000000</span><br><span class="line">CINDER_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore cinder user. exmaple:000000</span><br><span class="line">CINDER_PASS=000000</span><br><span class="line"></span><br><span class="line">#Cinder Block Disk. example:md126p3</span><br><span class="line">BLOCK_DISK=sdb1  //compute节点分好的区 用于cinder块存储 具体区你们的compute节点上查看 查看分区命令:lsblk</span><br><span class="line"></span><br><span class="line">#--------------------Swift Config---------------------##</span><br><span class="line">#Password for Keystore swift user. exmaple:000000</span><br><span class="line">SWIFT_PASS=000000</span><br><span class="line"></span><br><span class="line">#The NODE Object Disk for Swift. example:md126p4.</span><br><span class="line">OBJECT_DISK=sdb2//compute节点分好的区 用于swift对象存储 具体区你们的compute节点上查看 查看分区命令:lsblk</span><br><span class="line"></span><br><span class="line">#The NODE IP for Swift Storage Network. example:x.x.x.x.</span><br><span class="line">STORAGE_LOCAL_NET_IP=192.168.10.10//swift服务运行的节点 compute节点的ip</span><br><span class="line"></span><br><span class="line">#--------------------Heat Config----------------------##</span><br><span class="line">#Password for Mysql heat user. exmaple:000000</span><br><span class="line">HEAT_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore heat user. exmaple:000000</span><br><span class="line">HEAT_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Zun Config-----------------------##</span><br><span class="line">#Password for Mysql Zun user. exmaple:000000</span><br><span class="line">ZUN_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Zun user. exmaple:000000</span><br><span class="line">ZUN_PASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Mysql Kuryr user. exmaple:000000</span><br><span class="line">KURYR_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Kuryr user. exmaple:000000</span><br><span class="line">KURYR_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Ceilometer Config----------------##</span><br><span class="line">#Password for Gnocchi ceilometer user. exmaple:000000</span><br><span class="line">CEILOMETER_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore ceilometer user. exmaple:000000</span><br><span class="line">CEILOMETER_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------AODH Config----------------##</span><br><span class="line">#Password for Mysql AODH user. exmaple:000000</span><br><span class="line">AODH_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore AODH user. exmaple:000000</span><br><span class="line">AODH_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Barbican Config----------------##</span><br><span class="line">#Password for Mysql Barbican user. exmaple:000000</span><br><span class="line">BARBICAN_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Barbican user. exmaple:000000</span><br><span class="line">BARBICAN_PASS=000000</span><br></pre></td></tr></table></figure><br>执行安装脚本<br>controller节点<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iaas-pre-host.sh</span><br><span class="line">reboot</span><br><span class="line">iaas-install-mysql.sh</span><br><span class="line">iaas-install-keystone.sh</span><br><span class="line">iaas-install-glance.sh</span><br><span class="line">iaas-install-nova-controller.sh</span><br><span class="line">iaas-install-neutron-controller.sh</span><br><span class="line">iaas-install-dashboard.sh</span><br></pre></td></tr></table></figure><br>compute节点<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iaas-pre-host.sh</span><br><span class="line">reboot</span><br><span class="line">iaas-install-nova-compute.sh</span><br><span class="line">iaas-install-neutron-compute.sh</span><br></pre></td></tr></table></figure></p><h3 id="数据库安装（2分）"><a href="#数据库安装（2分）" class="headerlink" title="数据库安装（2分）"></a>数据库安装（2分）</h3><p>使用脚本安装数据库服务，进入数据库。</p><p>（1）创建本地用户examuser，密码为000000；</p><p>（2）查询mysql数据库中的user表的host，user，password字段；</p><p>（3）赋予这个用户对所有数据库拥有“查询”“删除”“更新”“创建”的本地权限。 依次将操作命令和返回结果以文本形式提交到答题框。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# mysql -uroot -p000000  //登录数据库</span><br><span class="line">[MariaDB [(none)]&gt; insert into mysql.user(host,user,Password) values(&quot;localhost&quot;,&quot;examuser&quot;,Password(&quot;000000&quot;));</span><br><span class="line">Query OK, 1 row affected, 4 warnings (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; select host,user,password from user;</span><br><span class="line">+-----------+----------+-------------------------------------------+</span><br><span class="line">| host      | user     | password                                  |</span><br><span class="line">+-----------+----------+-------------------------------------------+</span><br><span class="line">| localhost | root     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| xiandian  | root     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| 127.0.0.1 | root     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| ::1       | root     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | keystone | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | keystone | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | glance   | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | glance   | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | nova     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | nova     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | neutron  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | neutron  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | cinder   | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | cinder   | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | heat     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | heat     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | aodh     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| %         | aodh     | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| localhost | examuser | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">+-----------+----------+-------------------------------------------+</span><br><span class="line">19 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; grant select,delete,update,create on *.* to examuser@&quot;localhost&quot; identified by &quot;000000&quot;;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">MariaDB [mysql]&gt; flush privileges;  //刷新权限</span><br><span class="line">MariaDB [mysql]&gt; exit</span><br></pre></td></tr></table></figure></p><h3 id="keystone安装（2分）"><a href="#keystone安装（2分）" class="headerlink" title="keystone安装（2分）"></a>keystone安装（2分）</h3><p>使用脚本安装keystone服务，创建用户testuser，密码为xiandian，将testuser用户分配给admin项目，赋予用户admin的权限。依次将操作命令和查询结果以文本形式提交到答题框。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-keystone.sh</span><br><span class="line">[root@controller ~]# source /etc/keystone/admin-openrc.sh  //加载keystone的环境变量</span><br><span class="line">[root@controller ~]# openstack user create --domain demo --password xiandian testuser</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | 5a486c51bc8e4dffa4a181f6c54e0938 |</span><br><span class="line">| enabled   | True                             |</span><br><span class="line">| id        | ec6d67cdb3ac4b3ca827587c14be0a3e |</span><br><span class="line">| name      | testuser                         |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">[root@controller ~]# openstack role add --project admin --user testuser admin</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h3 id="glance安装（2分）"><a href="#glance安装（2分）" class="headerlink" title="glance安装（2分）"></a>glance安装（2分）</h3><p>使用脚本安装glance服务。使用CentOS_6.5_x86_64_XD.qcow2文件创建名为examimage的镜像；使用openstack命令查看镜像列表；设置该镜像的标签为lastone，查询镜像详细信息。依次将操作命令和查询结果以文本形式提交到答题框。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-glance.sh</span><br><span class="line">[root@controller ~]# glance image-create --name &quot;testone&quot; --disk-format &quot;qcow2&quot; --container-format bare --progress &lt; /root/CentOS_6.5_x86_64_XD.qcow2 </span><br><span class="line">[=============================&gt;] 100%</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| Property         | Value                                |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| checksum         | 3e565ace16066679ea363dde5411ed25     |</span><br><span class="line">| container_format | bare                                 |</span><br><span class="line">| created_at       | 2018-01-17T09:01:36Z                 |</span><br><span class="line">| disk_format      | qcow2                                |</span><br><span class="line">| id               | 3bb63ae0-3129-442b-b19f-9f66298132aa |</span><br><span class="line">| min_disk         | 0                                    |</span><br><span class="line">| min_ram          | 0                                    |</span><br><span class="line">| name             | examimage                            |</span><br><span class="line">| owner            | 0ab2dbde4f754b699e22461426cd0774     |</span><br><span class="line">| protected        | False                                |</span><br><span class="line">| size             | 283181056                            |</span><br><span class="line">| status           | active                               |</span><br><span class="line">| tags             | []                                   |</span><br><span class="line">| updated_at       | 2018-01-17T09:01:38Z                 |</span><br><span class="line">| virtual_size     | None                                 |</span><br><span class="line">| visibility       | private                              |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]#  openstack image list</span><br><span class="line">+--------------------------------------+-----------+--------+</span><br><span class="line">| ID                                   | Name      | Status |</span><br><span class="line">+--------------------------------------+-----------+--------+</span><br><span class="line">| 3bb63ae0-3129-442b-b19f-9f66298132aa | examimage | active |</span><br><span class="line">+--------------------------------------+-----------+--------+</span><br><span class="line">[root@controller ~]#  openstack image set examimage --tag lastone</span><br><span class="line">[root@controller ~]#  openstack image show examimage</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | 3e565ace16066679ea363dde5411ed25                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2018-01-17T09:01:36Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/3bb63ae0-3129-442b-b19f-9f66298132aa/file |</span><br><span class="line">| id               | 3bb63ae0-3129-442b-b19f-9f66298132aa                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | examimage                                            |</span><br><span class="line">| owner            | 0ab2dbde4f754b699e22461426cd0774                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 283181056                                            |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             | lastone                                              |</span><br><span class="line">| updated_at       | 2018-01-18T01:15:18Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | private                                              |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure><br>nova管理（2分）<br>使用脚本安装nova服务，通过nova的相关命令创建名为exam，ID为1234，内存为1024M，硬盘为20G，虚拟内核数量为2的云主机类型，查看exam的详细信息。依次将操作命令及返回结果以文本形式提交到答题框。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-nova-controller.sh /iaas-install-nova-compute.sh  nova服务是两个节点都要安装</span><br><span class="line">[root@xiandian ~]# nova flavor-create exam 1234 1024 20 2</span><br><span class="line">+------+------+-----------+------+-----------+------+-------+-------------+-----------+</span><br><span class="line">| ID   | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |</span><br><span class="line">+------+------+-----------+------+-----------+------+-------+-------------+-----------+</span><br><span class="line">| 1234 | exam | 1024      | 20   | 0         |      | 2     | 1.0         | True      |</span><br><span class="line">+------+------+-----------+------+-----------+------+-------+-------------+-----------+</span><br><span class="line">[root@xiandian ~]# nova flavor-show 1234</span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| Property                   | Value |</span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0     |</span><br><span class="line">| disk                       | 20    |</span><br><span class="line">| extra_specs                | &#123;&#125;    |</span><br><span class="line">| id                         | 1234  |</span><br><span class="line">| name                       | exam  |</span><br><span class="line">| os-flavor-access:is_public | True  |</span><br><span class="line">| ram                        | 1024  |</span><br><span class="line">| rxtx_factor                | 1.0   |</span><br><span class="line">| swap                       |       |</span><br><span class="line">| vcpus                      | 2     |</span><br><span class="line">+----------------------------+-------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>网络创建（2分）<br>使用脚本安装neutron服务，并配置为GRE网络：</p><p>（1）创建云主机外部网络为ext-net，子网为ext-subnet，虚拟机浮动IP网段为192.168.200.0/24，网关为192.168.200.1;</p><p>（2）创建云主机隧道网络int-net1，子网为int-subnet1，虚拟机子网IP网段为10.0.0.0/24，网关为10.0.0.1；</p><p>（3）创建云主机隧道网络int-net2，子网为int-subnet2，虚拟机子网IP网段为10.0.1.0/24，网关为10.0.1.1;</p><p>（4）添加名为ext-router的路由器，配置路由接口地址，完成隧道网络int-net1和外部网络ext-net的连通。</p><p>使用neutron相关命令查询子网的列表信息，并查看int-subnet1的详细信息。依次将操作命令和查询结果以文本形式提交到答题框。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-neutron-controller.sh/iaas-install-neutron-compute.sh neutron服务也是双节点</span><br><span class="line">[root@controller ~]# openstack network create --share --external \</span><br><span class="line">--provider-physical-network provider \</span><br><span class="line">--provider-network-type vlan \</span><br><span class="line">--provider-segment 1120 extnet  //vlanid 根据自己的情况来设置</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack subnet create --network extnet \</span><br><span class="line">  --allocation-pool start=192.168.200.2,end=192.168.200.254 \</span><br><span class="line">  --dns-nameserver 1.2.4.8 --gateway 192.168.200.1 \</span><br><span class="line">  --subnet-range 192.168.200.0/24 extsubnet</span><br><span class="line">---------------------------------------------------------------------------------------------- </span><br><span class="line">[root@controller ~]# openstack network create --share \</span><br><span class="line">intnet1</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack subnet create --network intnet1 \</span><br><span class="line">  --allocation-pool start=10.10.0.2,end=10.10.0.254 \</span><br><span class="line">  --dns-nameserver 1.2.4.8 --gateway 10.10.1.1 \</span><br><span class="line">  --subnet-range 10.10.0.0/24 intsubnet1</span><br><span class="line">----------------------------------------------------------------------------------------  </span><br><span class="line">  [root@controller ~]# openstack network create --share \</span><br><span class="line">intnet2</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack subnet create --network intnet2 \</span><br><span class="line">  --allocation-pool start=10.10.1.2,end=10.10.1.254 \</span><br><span class="line">  --dns-nameserver 1.2.4.8 --gateway 10.10.1.1 \</span><br><span class="line">  --subnet-range 10.10.1.0/24 intsubnet2</span><br><span class="line">  </span><br><span class="line">  路由配置-----------------------------------------------------------------</span><br><span class="line">[root@controller ~]# openstack router create ext-router</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack router set \</span><br><span class="line">--enable-snat --external-gateway extnet \</span><br><span class="line">--fixed-ip subnet=extsubnet ext-router</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack router add subnet ext-router intsubnet1</span><br><span class="line"></span><br><span class="line">查看------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[root@controller ~]# neutron subnet-list</span><br><span class="line"></span><br><span class="line">[root@controller ~]# neutron subnet-show 6386b9ad-c446-45ae-a947-8a44b580feaf</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>dashboard配置（1分）<br>使用脚本安装dashboard服务，使用curl命令查询<a href="http://192.168.100.10/dashboard。依次将操作命令和查询结果以文本形式提交到答题框。">http://192.168.100.10/dashboard。依次将操作命令和查询结果以文本形式提交到答题框。</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔迹 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>添加图片</title>
      <link href="/posts/37ae.html"/>
      <url>/posts/37ae.html</url>
      
        <content type="html"><![CDATA[<h2 id="图片添加"><a href="#图片添加" class="headerlink" title="图片添加"></a>图片添加</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;更新图片&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动化链接克隆虚拟机脚本</title>
      <link href="/posts/ee58.html"/>
      <url>/posts/ee58.html</url>
      
        <content type="html"><![CDATA[<h2 id="你好！世界"><a href="#你好！世界" class="headerlink" title="你好！世界"></a>你好！世界</h2><h3 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a>安装虚拟机</h3><p>安装虚拟机的时候勾上网卡选项<br>ip a 查看IP地址，链接上终端软件xshell等<br>忘记勾选，可以编辑网卡配置文件 vi /etc/sysconfig/network-scripts/ifcfg-ens33</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">PROXY_METHOD=none</span></span><br><span class="line"><span class="string">BROWSER_ONLY=no</span></span><br><span class="line"><span class="string">BOOTPROTO=dhcp</span> <span class="comment">#改成dhcp</span></span><br><span class="line"><span class="string">DEFROUTE=yes</span></span><br><span class="line"><span class="string">IPV4_FAILURE_FATAL=no</span></span><br><span class="line"><span class="string">IPV6INIT=yes</span></span><br><span class="line"><span class="string">IPV6_AUTOCONF=yes</span></span><br><span class="line"><span class="string">IPV6_DEFROUTE=yes</span></span><br><span class="line"><span class="string">IPV6_FAILURE_FATAL=no</span></span><br><span class="line"><span class="string">IPV6_ADDR_GEN_MODE=stable-privacy</span></span><br><span class="line"><span class="string">NAME=ens33</span></span><br><span class="line"><span class="string">UUID=e97ec6f4-50db-4474-a67e-4c921058d661</span></span><br><span class="line"><span class="string">DEVICE=ens33</span></span><br><span class="line"><span class="string">ONBOOT=yes</span> <span class="comment">#no改成yes</span></span><br></pre></td></tr></table></figure><p>重启网卡systemctl restark network 再ip a 查看IP地址，链接上终端软件xshell等</p><h3 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repo.d/* /home</span><br><span class="line">vi /etc/yum.repo.d/a.repo</span><br></pre></td></tr></table></figure><h3 id="repo内容如下"><a href="#repo内容如下" class="headerlink" title="repo内容如下"></a>repo内容如下</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">a</span>]</span><br><span class="line"><span class="string">name=a</span></span><br><span class="line"><span class="string">baseurl=file:///media</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br></pre></td></tr></table></figure><h3 id="挂载安装软件，kvm安装虚拟机"><a href="#挂载安装软件，kvm安装虚拟机" class="headerlink" title="挂载安装软件，kvm安装虚拟机"></a>挂载安装软件，kvm安装虚拟机</h3><p>将镜像文件上传到opt目录下<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/cdrom /media</span><br><span class="line">yum install -y libvirt virt-install qemu-kvm vim</span><br><span class="line">systemctl start libvirtd.service</span><br><span class="line">systemctl status libvirtd.service</span><br><span class="line">systemctl stop firewalld </span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld </span><br><span class="line">virt-install --virt-type kvm --os-type=linux --os-variant rhel7 --name centos7 --memory 1024 --vcpus 1 --disk /opt/centos.raw,format=raw,size=10 --cdrom /opt/CentOS-7-x86_64-DVD-1810.iso --network network=default --graphics vnc,listen=0.0.0.0 --noautoconsole</span><br></pre></td></tr></table></figure></p><h3 id="在vnc连接虚拟机安装虚拟机，过程省略"><a href="#在vnc连接虚拟机安装虚拟机，过程省略" class="headerlink" title="在vnc连接虚拟机安装虚拟机，过程省略"></a>在vnc连接虚拟机安装虚拟机，过程省略</h3><p>名字按实际情况修改<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br><span class="line">virsh destroy centos7</span><br><span class="line">virsh domrename centos7 ao</span><br><span class="line">virsh list --all</span><br></pre></td></tr></table></figure></p><h3 id="更改磁盘格式"><a href="#更改磁盘格式" class="headerlink" title="更改磁盘格式"></a>更改磁盘格式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">qemu-img convert -f raw -O qcow2 centos.raw centos.qcow2</span><br><span class="line">virsh edit ao</span><br></pre></td></tr></table></figure><h3 id="更改以下内容"><a href="#更改以下内容" class="headerlink" title="更改以下内容"></a>更改以下内容</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;devices&gt;</span></span><br><span class="line">   <span class="string">&lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span></span><br><span class="line">   <span class="string">&lt;disk</span> <span class="string">type=&#x27;file&#x27;</span> <span class="string">device=&#x27;disk&#x27;&gt;</span></span><br><span class="line">     <span class="string">&lt;driver</span> <span class="string">name=&#x27;qemu&#x27;</span> <span class="string">type=&#x27;qcow2&#x27;/&gt;</span> <span class="comment">#raw改成qcow2</span></span><br><span class="line">     <span class="string">&lt;source</span> <span class="string">file=&#x27;/opt/centos.qcow2&#x27;/&gt;</span> <span class="comment">#raw改成qcow2</span></span><br><span class="line">     <span class="string">&lt;target</span> <span class="string">dev=&#x27;vda&#x27;</span> <span class="string">bus=&#x27;virtio&#x27;/&gt;</span></span><br><span class="line">     <span class="string">&lt;address</span> <span class="string">type=&#x27;pci&#x27;</span> <span class="string">domain=&#x27;0x0000&#x27;</span> <span class="string">bus=&#x27;0x00&#x27;</span> <span class="string">slot=&#x27;0x06&#x27;</span> <span class="string">function=&#x27;0x0&#x27;/&gt;</span></span><br><span class="line">   <span class="string">&lt;/disk&gt;</span></span><br></pre></td></tr></table></figure><h3 id="开机验证-virsh-start-ao"><a href="#开机验证-virsh-start-ao" class="headerlink" title="开机验证  virsh start ao"></a>开机验证  virsh start ao</h3><h3 id="快照管理"><a href="#快照管理" class="headerlink" title="快照管理"></a>快照管理</h3><p>名字按实际情况修改<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virsh snapshot-create-as ao</span><br><span class="line">virsh snapshot-list ao </span><br><span class="line">virsh snapshot-revert ao 167093632 </span><br><span class="line">virsh snapshot-delete ao --snapshotname 1670936324</span><br></pre></td></tr></table></figure></p><h3 id="自动化克隆完整虚拟机web01"><a href="#自动化克隆完整虚拟机web01" class="headerlink" title="自动化克隆完整虚拟机web01"></a>自动化克隆完整虚拟机web01</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ll -h</span><br><span class="line">virt-clone --auto-clone -o ao -n web01</span><br><span class="line">ll -h</span><br><span class="line">virsh dumpxml web01|grep qcow2</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /server/scripts</span><br><span class="line"><span class="built_in">cd</span> /server/scripts</span><br><span class="line">vim link_clone.sh</span><br></pre></td></tr></table></figure><h3 id="内容如下"><a href="#内容如下" class="headerlink" title="内容如下"></a>内容如下</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="string">new_vm=$1</span></span><br><span class="line"><span class="string">qemu-img</span> <span class="string">create</span> <span class="string">-f</span> <span class="string">qcow2</span> <span class="string">-b</span> <span class="string">/opt/centos.qcow2</span> <span class="string">/opt/$&#123;new_vm&#125;.qcow2</span></span><br><span class="line"><span class="string">virsh</span> <span class="string">dumpxml</span> <span class="string">ao</span> <span class="string">&gt;/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-ri</span> <span class="string">&quot;s#(&lt;name&gt;)(.*)(&lt;/name&gt;)#\1$&#123;new_vm&#125;\3#g&quot;</span> <span class="string">/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;/&lt;uuid&gt;/d&#x27;</span> <span class="string">/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;/&lt;mac address/d&#x27;</span> <span class="string">/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-ri</span> <span class="string">&quot;s#(&lt;source file=&#x27;)(.*)(&#x27;/&gt;)#\1/opt/$&#123;new_vm&#125;.qcow2\3#g&quot;</span> <span class="string">/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">virsh</span> <span class="string">define</span> <span class="string">/tmp/$&#123;new_vm&#125;.xml</span></span><br><span class="line"><span class="string">virsh</span> <span class="string">start</span> <span class="string">$&#123;new_vm&#125;</span></span><br></pre></td></tr></table></figure><h3 id="sh-link-clone-sh-新名字"><a href="#sh-link-clone-sh-新名字" class="headerlink" title="sh link_clone.sh 新名字"></a>sh link_clone.sh 新名字</h3>]]></content>
      
      
      <categories>
          
          <category> 学习笔迹 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
